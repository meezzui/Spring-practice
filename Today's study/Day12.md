### μ¤λμ μΌκΈ°
---
#### μ¤ν”„λ§ μΈν„°μ…‰ν„°
+ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ„ μ„λΈ”λ¦Ώ ν•„ν„°μ™€ κ°™μ΄ μ›Ήκ³Ό κ΄€λ ¨λ κ³µν†µ κ΄€μ‹¬ μ‚¬ν•­μ„ ν¨κ³Όμ μΌλ΅ ν•΄κ²°ν•  μ μλ” κΈ°μ μ΄λ‹¤.
+ μ„λΈ”λ¦Ώ ν•„ν„°κ°€ μ„λΈ”λ¦Ώμ΄ μ κ³µν•λ” κΈ°μ μ΄λΌλ©΄, μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ¤ν”„λ§ MVCκ°€ μ κ³µν•λ” κΈ°μ μ΄λ‹¤. 
+ λ‘λ‹¤ μ›Ήκ³Ό κ΄€λ ¨λ κ³µν†µ κ΄€μ‹¬ μ‚¬ν•­μ„ μ²λ¦¬ν•μ§€λ§, μ μ©λλ” μμ„μ™€ λ²”μ„, κ·Έλ¦¬κ³  μ‚¬μ©λ°©λ²•μ΄ λ‹¤λ¥΄λ‹¤.

#### μ¤ν”„λ§ μΈν„°μ…‰ν„° νλ¦„
+ `HTTP μ”μ²­ -> WAS -> ν•„ν„° -> μ„λΈ”λ¦Ώ -> μ¤ν”„λ§ μΈν„°μ…‰ν„° -> μ»¨νΈλ΅¤λ¬`
+ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” λ””μ¤ν¨μ² μ„λΈ”λ¦Ώκ³Ό μ»¨νΈλ΅¤λ¬ μ‚¬μ΄μ—μ„ μ»¨νΈλ΅¤λ¬ νΈμ¶ μ§μ „μ— νΈμ¶ λλ‹¤.
+ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ¤ν”„λ§ MVCκ°€ μ κ³µν•λ” κΈ°λ¥μ΄κΈ° λ•λ¬Έμ— κ²°κµ­ λ””μ¤ν¨μ² μ„λΈ”λ¦Ώ μ΄ν›„μ— λ“±μ¥ν•κ² λλ‹¤. 
+ μ¤ν”„λ§ MVCμ μ‹μ‘μ μ΄ λ””μ¤ν¨μ² μ„λΈ”λ¦Ώμ΄λΌκ³  μƒκ°ν•λ©΄ μ΄ν•΄κ°€ νΈν•λ‹¤.
+ μ¤ν”„λ§ μΈν„°μ…‰ν„°μ—λ„ URL ν¨ν„΄μ„ μ μ©ν•  μ μλ”λ°, μ„λΈ”λ¦Ώ URL ν¨ν„΄κ³Όλ” λ‹¤λ¥΄κ³ , λ§¤μ° μ •λ°€ν•κ² μ„¤μ •ν•  μ μλ‹¤.

#### μ¤ν”„λ§ μΈν„°μ…‰ν„° μ ν•
```
HTTP μ”μ²­ -> WAS -> ν•„ν„° -> μ„λΈ”λ¦Ώ -> μ¤ν”„λ§ μΈν„°μ…‰ν„° -> μ»¨νΈλ΅¤λ¬ //λ΅κ·ΈμΈ μ‚¬μ©μ
HTTP μ”μ²­ -> WAS -> ν•„ν„° -> μ„λΈ”λ¦Ώ -> μ¤ν”„λ§ μΈν„°μ…‰ν„°(μ μ ν•μ§€ μ•μ€ μ”μ²­μ΄λΌ νλ‹¨, μ»¨νΈλ΅¤λ¬ νΈμ¶ X) // λΉ„ λ΅κ·ΈμΈ μ‚¬μ©μ
```
+ μΈν„°μ…‰ν„°μ—μ„ μ μ ν•μ§€ μ•μ€ μ”μ²­μ΄λΌκ³  νλ‹¨ν•λ©΄ κ±°κΈ°μ—μ„ λμ„ λ‚Ό μλ„ μλ‹¤. 
+ κ·Έλμ„ λ΅κ·ΈμΈ μ—¬λ¶€λ¥Ό μ²΄ν¬ν•κΈ°μ— λ”± μΆ‹λ‹¤.(κµΏμ΄μ—μ π‰)

#### μ¤ν”„λ§ μΈν„°μ…‰ν„° μ²΄μΈ
+ `HTTP μ”μ²­ -> WAS -> ν•„ν„° -> μ„λΈ”λ¦Ώ -> μΈν„°μ…‰ν„°1 -> μΈν„°μ…‰ν„°2 -> μ»¨νΈλ΅¤λ¬`
+ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ²΄μΈμΌλ΅ κµ¬μ„±λλ”λ°, μ¤‘κ°„μ— μΈν„°μ…‰ν„°λ¥Ό μμ λ΅­κ² μ¶”κ°€ν•  μ μλ‹¤. 
+ μλ¥Ό λ“¤μ–΄μ„ λ΅κ·Έλ¥Ό λ‚¨κΈ°λ” μΈν„°μ…‰ν„°λ¥Ό λ¨Όμ € μ μ©ν•κ³ , κ·Έ λ‹¤μμ— λ΅κ·ΈμΈ μ—¬λ¶€λ¥Ό μ²΄ν¬ν•λ” μΈν„°μ…‰ν„°λ¥Ό λ§λ“¤ μ μλ‹¤.  

π μ΄μ²λΌ μ„λΈ”λ¦Ώ ν•„ν„°μ™€ νΈμ¶ λλ” μμ„λ§ λ‹¤λ¥΄κ³ , μ κ³µν•λ” κΈ°λ¥μ€ λΉ„μ·ν•λ‹¤. κ·Έλ¬λ‚ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ„λΈ”λ¦Ώ ν•„ν„°λ³΄λ‹¤ νΈλ¦¬ν•κ³ , λ” μ •κµν•κ³  λ‹¤μ–‘ν• κΈ°λ¥μ„ μ§€μ›ν•λ‹¤.  


#### μ¤ν”„λ§ μΈν„°μ…‰ν„° μΈν„°νμ΄μ¤
+ μ¤ν”„λ§μ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ `HandlerInterceptor `μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ©΄ λλ‹¤.
+ HandlerInterceptorλ€?
  + νΉμ •ν• URI νΈμ¶μ„ 'κ°€λ΅μ±„λ”' μ—­ν• μ„ ν•λ‹¤. μ΄λ¥Ό μ΄μ©ν•μ—¬ κΈ°μ΅΄ μ»¨νΈλ΅¤λ¬μ λ΅μ§μ„ μμ •ν•μ§€ μ•κ³ λ„, μ‚¬μ „μ΄λ‚ μ‚¬ν›„ μ μ–΄κ°€ κ°€λ¥ν•λ‹¤.
  + μ„λΈ”λ¦Ώ ν•„ν„°μ κ²½μ° λ‹¨μν•κ² doFilter() ν•λ‚λ§ μ κ³µλλ‹¤.
  + κ·Έλ¬λ‚ μΈν„°μ…‰ν„°λ” μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „( preHandle ), νΈμ¶ ν›„( postHandle ), μ”μ²­ μ™„λ£ μ΄ν›„(afterCompletion)μ™€ κ°™μ΄ λ‹¨κ³„μ μΌλ΅ μ μ„Έλ¶„ν™” λμ–΄ μλ‹¤.
    + `preHandle(request, response, handler)` : μ§€μ •λ μ»¨νΈλ΅¤λ¬μ λ™μ‘ μ΄μ „μ— μν–‰ν•  λ™μ‘ (μ‚¬μ „ μ μ–΄).
    + `postHandle(request, response, handler, modelAndView)` : μ§€μ •λ μ»¨νΈλ΅¤λ¬μ λ™μ‘ μ΄ν›„μ— μ²λ¦¬ν•  λ™μ‘ (μ‚¬ν›„ μ μ–΄). Spring MVCμ Dispatcher Servletμ΄ ν™”λ©΄μ„ μ²λ¦¬ν•κΈ° μ „μ— λ™μ‘.
    + `afterCompletion(request, reponse, handler, exception)` : Dispatcher Servletμ ν™”λ©΄ μ²λ¦¬κ°€ μ™„λ£λ μ΄ν›„ μ²λ¦¬ν•  λ™μ‘.
  + μ„λΈ”λ¦Ώ ν•„ν„°μ κ²½μ° λ‹¨μν request , response λ§ μ κ³µν–μ§€λ§, μΈν„°μ…‰ν„°λ” μ–΄λ–¤ μ»¨νΈλ΅¤λ¬( handler )κ°€ νΈμ¶λλ”μ§€ νΈμ¶ μ •λ³΄λ„ λ°›μ„ μ μλ‹¤. 
  + κ·Έλ¦¬κ³  μ–΄λ–¤ modelAndView κ°€ λ°ν™λλ”μ§€ μ‘λ‹µ μ •λ³΄λ„ λ°›μ„ μ μλ‹¤.

#### μ¤ν”„λ§ μΈν„°μ…‰ν„° νΈμ¶ νλ¦„
<img width="500" src="https://user-images.githubusercontent.com/86812098/152630563-95453742-d1f0-4836-a09c-1bba12ea6322.png">

+ μ •μƒ νλ¦„
  + `preHandle` : μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „μ— νΈμ¶λλ‹¤. (λ” μ •ν™•νλ” ν•Έλ“¤λ¬ μ–΄λ‘ν„° νΈμ¶ μ „μ— νΈμ¶λλ‹¤.)
    + preHandle μ μ‘λ‹µκ°’μ΄ true μ΄λ©΄ λ‹¤μμΌλ΅ μ§„ν–‰ν•κ³ , false μ΄λ©΄ λ”λ” μ§„ν–‰ν•μ§€ μ•λ”λ‹¤. 
    + falseμΈ κ²½μ° λ‚λ¨Έμ§€ μΈν„°μ…‰ν„°λ” λ¬Όλ΅ μ΄κ³ , ν•Έλ“¤λ¬ μ–΄λ‘ν„°λ„ νΈμ¶λμ§€ μ•λ”λ‹¤. κ·Έλ¦Όμ—μ„ 1λ²μ—μ„ λλ‚ λ²„λ¦°λ‹¤.
  + `postHandle` : μ»¨νΈλ΅¤λ¬ νΈμ¶ ν›„μ— νΈμ¶λλ‹¤. (λ” μ •ν™•νλ” ν•Έλ“¤λ¬ μ–΄λ‘ν„° νΈμ¶ ν›„μ— νΈμ¶λλ‹¤.)
  + `afterCompletion` : λ·°κ°€ λ λ”λ§ λ μ΄ν›„μ— νΈμ¶λλ‹¤.

+ μ¤ν”„λ§ μΈν„°μ…‰ν„° μμ™Έ μƒν™©
<img width="500" src="https://user-images.githubusercontent.com/86812098/152630657-d11fbb59-6152-4a87-b64d-e048c57a9e16.png">

+ μμ™Έκ°€ λ°μƒμ‹
  + `preHandle` : μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „μ— νΈμ¶λλ‹¤.
  + `postHandle` : μ»¨νΈλ΅¤λ¬μ—μ„ μμ™Έκ°€ λ°μƒν•λ©΄ `postHandle`μ€ νΈμ¶λμ§€ μ•λ”λ‹¤.
  + `afterCompletion` : `afterCompletion` μ€ ν•­μƒ νΈμ¶λλ‹¤. μ΄ κ²½μ° μμ™Έλ¥Ό νλΌλ―Έν„°λ΅ λ°›μ•„μ„ μ–΄λ–¤ μμ™Έκ°€ λ°μƒν–λ”μ§€ λ΅κ·Έλ΅ μ¶λ ¥ν•  μ μλ‹¤.
    + μμ™Έκ°€ λ°μƒν•λ©΄ `postHandle()` λ” νΈμ¶λμ§€ μ•μΌλ―€λ΅ μμ™Έμ™€ λ¬΄κ΄€ν•κ² κ³µν†µ μ²λ¦¬λ¥Ό ν•λ ¤λ©΄ `afterCompletion()` μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.
    + μμ™Έκ°€ λ°μƒν•λ©΄ `afterCompletion()`μ— μμ™Έ μ •λ³΄λ¥Ό ν¬ν•¨ν•΄μ„ νΈμ¶λλ‹¤.  
π μ¦‰, μΈν„°μ…‰ν„°λ” μ¤ν”„λ§ MVC κµ¬μ΅°μ— νΉν™”λ ν•„ν„° κΈ°λ¥μ„ μ κ³µν•λ‹¤κ³  μ΄ν•΄ν•λ©΄ λλ‹¤. μ¤ν”„λ§ MVCλ¥Ό μ‚¬μ©ν•κ³ , νΉλ³„ν ν•„ν„°λ¥Ό κΌ­ μ‚¬μ©ν•΄μ•Ό ν•λ” μƒν™©μ΄ μ•„λ‹λΌλ©΄ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ λ” νΈλ¦¬ν•λ‹¤.  

#### μ¤ν”„λ§ μΈν„°μ…‰ν„° - μ”μ²­ λ΅κ·Έ
+ `String uuid = UUID.randomUUID().toString()` μ”μ²­ λ΅κ·Έλ¥Ό κµ¬λ¶„ν•κΈ° μ„ν• uuid λ¥Ό μƒμ„±ν•λ‹¤.
+ `request.setAttribute(LOG_ID, uuid)` 
  + μ„λΈ”λ¦Ώ ν•„ν„°μ κ²½μ° μ§€μ—­λ³€μλ΅ ν•΄κ²°μ΄ κ°€λ¥ν•μ§€λ§, μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” νΈμ¶ μ‹μ μ΄ μ™„μ „ν λ¶„λ¦¬λμ–΄ μλ‹¤. 
  + λ”°λΌμ„ preHandle μ—μ„ μ§€μ •ν• κ°’μ„ postHandle , afterCompletion μ—μ„ ν•¨κ» μ‚¬μ©ν•λ ¤λ©΄ μ–΄λ”κ°€μ— λ‹΄μ•„λ‘μ–΄μ•Ό ν•λ‹¤.(μ¤νΈλΌπ§)
  + LogInterceptor λ„ μ‹±κΈ€ν†¤ μ²λΌ μ‚¬μ©λκΈ° λ•λ¬Έμ— λ§΄λ²„λ³€μλ¥Ό μ‚¬μ©ν•λ©΄ μ„ν—ν•λ‹¤.πƒ
  + κ·Έλμ„ request μ— λ‹΄μ•„λ‘μ—λ‹¤. μ΄ κ°’μ€ afterCompletion μ—μ„ `request.getAttribute(LOG_ID)` λ΅ μ°Ύμ•„μ„ μ‚¬μ©ν•λ‹¤.
```java
if (handler instanceof HandlerMethod) {
     HandlerMethod hm = (HandlerMethod) handler; //νΈμ¶ν•  μ»¨νΈλ΅¤λ¬ λ©”μ„λ“μ λ¨λ“  μ •λ³΄κ°€ ν¬ν•¨λμ–΄ μλ‹¤.
   }
     log.info("REQUEST [{}][{}][{}]", uuid, requestURI, handler);
     return true; //true λ©΄ μ •μƒ νΈμ¶μ΄λ‹¤. λ‹¤μ μΈν„°μ…‰ν„°λ‚ μ»¨νΈλ΅¤λ¬κ°€ νΈμ¶λλ‹¤.(falseλ©΄ μ§„ν–‰μ•ν•¨)
```

#### HandlerMethod
+ ν•Έλ“¤λ¬ μ •λ³΄λ” μ–΄λ–¤ ν•Έλ“¤λ¬ λ§¤ν•‘μ„ μ‚¬μ©ν•λ”κ°€μ— λ”°λΌ λ‹¬λΌμ§„λ‹¤. 
+ μ¤ν”„λ§μ„ μ‚¬μ©ν•λ©΄ μΌλ°μ μΌλ΅ @Controller , @RequestMapping μ„ ν™μ©ν• ν•Έλ“¤λ¬ λ§¤ν•‘μ„ μ‚¬μ©ν•λ”λ°, μ΄ κ²½μ° ν•Έλ“¤λ¬ μ •λ³΄λ΅ HandlerMethod κ°€ λ„μ–΄μ¨λ‹¤.

#### ResourceHttpRequestHandler
+ @Controller κ°€ μ•„λ‹λΌ /resources/static μ™€ κ°™μ€ μ •μ  λ¦¬μ†μ¤κ°€ νΈμ¶ λλ” κ²½μ° ResourceHttpRequestHandlerκ°€ ν•Έλ“¤λ¬ μ •λ³΄λ΅ λ„μ–΄μ¤κΈ° λ•λ¬Έμ— νƒ€μ…μ— λ”°λΌμ„ μ²λ¦¬κ°€ ν•„μ”ν•λ‹¤.

#### postHandle, afterCompletion
+ μΆ…λ£ λ΅κ·Έλ¥Ό postHandle μ΄ μ•„λ‹λΌ afterCompletion μ—μ„ μ‹¤ν–‰ν• μ΄μ λ”, μμ™Έκ°€ λ°μƒν• κ²½μ° postHandle κ°€ νΈμ¶λμ§€ μ•κΈ° λ•λ¬Έμ΄λ‹¤. 
+ afterCompletion μ€ μμ™Έκ°€ λ°μƒν•΄λ„ νΈμ¶ λλ” κ²ƒμ„ λ³΄μ¥ν•λ‹¤.

#### μΈν„°μ…‰ν„° λ“±λ΅
+ `addInterceptors` λ©”μ„λ“λ¥Ό κµ¬ν„μ„ ν•  λ• μ„μ™€ κ°™μ΄ κµ¬ν„μ„ ν•λ©°, μΈν„°μ…‰ν„° κµ¬ν„ μ‹ λ©”μ„λ“ μ²΄μ΄λ‹μ„ λμ–΄μμ–΄ μ—°μ†μ μΌλ΅ λ‹¤λ¥Έ μ¶”κ°€ ν¨ν„΄λ„ λ“±λ΅ν•  μ μλ‹¤.
  + `registry.addInterceptor(new LogInterceptor())` : μΈν„°μ…‰ν„°λ¥Ό λ“±λ΅ν•λ‹¤.
+ `addPathPatterns` μ μ©ν•  url ν¨ν„΄μ„ μ„¤μ •ν•λ‹¤. *, **λ“±μ„ μ‚¬μ©ν• URI Pattern Stringμ„ μ „μ†΅ν•κ±°λ‚, URI Pattern λ°°μ—΄μ„ μ „μ†΅ν•  μ μλ‹¤.
  + `addPathPatterns("/**")` : μΈν„°μ…‰ν„°λ¥Ό μ μ©ν•  URL ν¨ν„΄μ„ μ§€μ •ν•λ‹¤.
+ `excludePathPatterns` μΈν„°μ…‰ν„°λ¥Ό μ μ™Έν•  url ν¨ν„΄μ„ λ“±λ΅ν•λ” λ©”μ„λ“λ΅μ¨ ν•΄λ‹Ή urlλ΅ μ ‘κ·Ό μ‹μ—λ” μΈν„°μ…‰ν„°λ¥Ό μ μ©ν•μ§€ μ•κ² λλ‹¤.

#### μ¤ν”„λ§μ URL κ²½λ΅
+ μ¤ν”„λ§μ΄ μ κ³µν•λ” URL κ²½λ΅λ” μ„λΈ”λ¦Ώ κΈ°μ μ΄ μ κ³µν•λ” URL κ²½λ΅μ™€ μ™„μ „ν λ‹¤λ¥΄λ‹¤. 
+ λ”μ± μμ„Έν•κ³ , μ„Έλ°€ν•κ² μ„¤μ •ν•  μ μλ‹¤. 
+ [μ°Έκ³ λ¬Έμ„](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html)

#### μ¤ν”„λ§ μΈν„°μ…‰ν„° - μΈμ¦ μ²΄ν¬
+ μ„λΈ”λ¦Ώ ν•„ν„°μ™€ λΉ„κµν•΄μ„ μ½”λ“κ°€ λ§¤μ° κ°„κ²°ν•λ‹¤. 
+ μΈμ¦μ΄λΌλ” κ²ƒμ€ μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „μ—λ§ νΈμ¶λλ©΄ λλ‹¤. λ”°λΌμ„ preHandle λ§ κµ¬ν„ν•λ©΄ λλ‹¤.
+ μΈν„°μ…‰ν„°λ¥Ό μ μ©ν•κ±°λ‚ ν•μ§€ μ•μ„ λ¶€λ¶„μ€ addPathPatterns μ™€ excludePathPatterns μ— μ‘μ„±ν•λ©΄ λλ‹¤.  

π’™μ •λ¦¬ν•μλ©΄ μ„λΈ”λ¦Ώ ν•„ν„°μ™€ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ›Ήκ³Ό κ΄€λ ¨λ κ³µν†µ κ΄€μ‹¬μ‚¬λ¥Ό ν•΄κ²°ν•κΈ° μ„ν• κΈ°μ μ΄λ‹¤. κ·Έλ°λ° μ¤ν”„λ§ μΈν„°μ…‰ν„°κ°€ κ°λ°μ μ…μ¥μ—μ„ ν›¨μ”¬ νΈλ¦¬ν•λ‹¤. νΉλ³„ν• λ¬Έμ κ°€ μ—†λ‹¤λ©΄ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.(μ΄κ±°μ¥π)π’™  
