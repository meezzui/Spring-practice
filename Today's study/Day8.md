### HTTP 쿠키( Cookie) 란?
+ HTTP 쿠키는 웹 쿠키, 브라우저 쿠키로도 불리는데 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각을 의미한다.
+ 쿠키의 데이터 형태는 Key 와 Value로 구성되고 String 형태로 이루어져 있다.
+ HTTP 통신은 stateless 하기 때문에 클라이언트를 확인하기 위해서는 쿠키라는 개념이 따로 필요하다.
  + 브라우저마다 저장되는 쿠키는 다르다. (크롬으로 남긴 쿠키는 인터넷 익스플로어에서 사용할 수 없다.)
  + 서버에서는 브라우저가 다르면 다른 사용자로 인식한다.
+ 즉, 내가 가지고 있으며 서버를 이용할 때마다 보여주는 것🎃
+ 쿠키의 사용목적
  + 세션 관리
    + 서버에서 관리하는 로그인 등의 정보를 의미한다.
  + 개인 설정유지
  + 사용자 트래킹
    + 사용자의 행동을 기록하고 분석하는 것.
+ 쿠키 특징
  + 이름, 값, 만료일(저장기간), 경로 정보로 구성되어 있다.
  + 클라이언트에 총 300개의 쿠키를 저장할 수 있다.
  + 하나의 도메인 당 20개의 쿠키를 가질 수 있다.
  + 하나의 쿠키는 4KB(=4096byte)까지 저장 가능하다.
+ 쿠키 동작방식
  + 클라이언트가 페이지를 요청한다. (사용자가 웹사이트에 접근)
  + 웹 서버는 쿠키를 생성한다.
  + 생성한 쿠키에 정보를 담아 HTTP 화면을 돌려줄 때, 같이 클라이언트에게 돌려준다.
  + 넘겨받은 쿠키는 클라이언트가 가지고 있다가(로컬 PC에 저장) 다시 서버에 요청할 때 요청과 함께 쿠키를 전송한다.
  + 동일 사이트 재방문 시 클라이언트의 PC에 해당 쿠키가 있는 경우, 요청 페이지와 함께 쿠키를 전송한다.
+ 사용 예시
  + 방문 사이트에서 로그인 시, "아이디와 비밀번호를 저장하시겠습니까?"
  + 팝업창을 통해 "오늘 이 창을 다시 보지 않기" 체크


### HTTP의 stateless 란?
+ HTTP에서 stateless 하다는건 서버 입장에서 클라이언트의 상태가 없다는 의미로 동일한 클라이언트의 요청이라도 매번 각 요청은 독립적이라는 의미이다.
+ 서버에서 이미 요청을 했었던 클라이언트인지 매번 확인하기 어렵기 때문에 입장권처럼 쿠키를 주는 것이다.


### 오늘의 일기
---
🎈쿠키만으로 로그인 기능 만들어 보기🎈  

#### 로그인 처리하기 - 쿠키 사용
+ 쿠키를 사용해서 로그인, 로그아웃 기능 구현하기(쿼리 파라미터를 계속 유지하면서 보내는 것은 매우 어렵고 번거로운 작업이다. 그래서 쿠키를 사용)
+ 로그인 상태 유지
  + 서버에서 로그인에 성공하면 HTTP 응답에 쿠키를 담아서 브라우저에 전달한다.
  + 그러면 브라우저는 앞으로 해당 쿠키를 지속해서 보내준다.
  + 쿠키 생성로직
  ```java
  Cookie idCookie = new Cookie("memberId", String.valueOf(loginMember.getId()));
  response.addCookie(idCookie);
  ```
  + 로그인에 성공하면 쿠키를 생성하고 HttpServletResponse 에 담는다. 
  + 쿠키 이름은 memberId 이고, 값은 회원의 id 를 담아둔다. 
  + 웹 브라우저는 종료 전까지 회원의 id 를 서버에 계속 보내줄 것이다.
  
+ 로그아웃 기능
  + 세션 쿠키이므로 웹 브라우저 종료시 서버에서 해당 쿠키의 종료 날짜를 0으로 지정
  + 로그아웃 시 해당 쿠키는 즉시 종료된다.
  ```java
  @PostMapping("/logout")
  public String logout(HttpServletResponse response) {
   expireCookie(response, "memberId");
   return "redirect:/";
  }
  private void expireCookie(HttpServletResponse response, String cookieName) {
   Cookie cookie = new Cookie(cookieName, null);
   cookie.setMaxAge(0);
   response.addCookie(cookie);
  }
  ```

#### 쿠키와 보안 문제
+ 쿠키를 사용해서 로그인Id를 전달해서 로그인을 유지할 수 있었다. 그런데 여기에는 심각한 보안 문제가 있다.
  + 보안 문제
    + 쿠키 값은 임의로 변경할 수 있다.
      + 클라이언트가 쿠키를 강제로 변경하면 다른 사용자가 된다.
      + 실제 웹브라우저 개발자모드 -> Application -> Cookie 변경으로 확인
      + Cookie: memberId=1 Cookie: memberId=2 (다른 사용자의 이름이 보임)
    + 쿠키에 보관된 정보는 훔쳐갈 수 있다.
       + 만약 쿠키에 개인정보나, 신용카드 정보가 있다면?
       + 이 정보가 웹 브라우저에도 보관되고, 네트워크 요청마다 계속 클라이언트에서 서버로 전달된다.
       + 쿠키의 정보가 나의 로컬 PC가 털릴 수도 있고, 네트워크 전송 구간에서 털릴 수도 있다.
    + 해커가 쿠키를 한번 훔쳐가면 평생 사용할 수 있다.
      + 해커가 쿠키를 훔쳐가서 그 쿠키로 악의적인 요청을 계속 시도할 수 있다.
  + 대안
    + 쿠키에 중요한 값을 노출하지 않고, 사용자 별로 예측 불가능한 임의의 토큰(랜덤 값)을 노출하고, 서버에서 토큰과 사용자 id를 매핑해서 인식한다. 그리고 서버에서 토큰을 관리한다.
    + 토큰은 해커가 임의의 값을 넣어도 찾을 수 없도록 예상 불가능 해야 한다.
    + 해커가 토큰을 털어가도 시간이 지나면 사용할 수 없도록 서버에서 해당 토큰의 만료시간을 짧게(예: 30분) 유지한다. 또는 해킹이 의심되는 경우 서버에서 해당 토큰을 강제로 제거하면 된다.

+ 세션
  + 쿠키에 중요한 정보를 보관하는 방법은 여러가지 보안 이슈가 있었다. 
  + 이 문제를 해결하려면 결국 중요한 정보를 모두 서버에 저장해야 한다. 그리고 클라이언트와 서버는 추정 불가능한 임의의 식별자 값으로 연결해야 한다.
  + 이렇게 서버에 중요한 정보를 보관하고 연결을 유지하는 방법을 '세션'이라 한다











